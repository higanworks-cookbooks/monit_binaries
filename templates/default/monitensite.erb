#!/bin/sh -e
## Refernce: Opscode-cookbook::nginx 

SYSCONFDIR='<%= node['monit']['dir'] %>'

if [ -z $1 ]; then
        echo "Which setting would you like to enable?"
        echo -n "Your choices are: "
        ls $SYSCONFDIR/monit.avail/* | \
        sed -e "s,$SYSCONFDIR/monit.avail/,,g" | xargs echo
        echo -n "Setting name? (without .conf)"
        read SITENAME
else
        SITENAME=$1.conf
fi

if [ -e $SYSCONFDIR/monit.enable/$SITENAME -o \
     -e $SYSCONFDIR/monit.enable/"$PRIORITY"-"$SITENAME" ]; then
        echo "This Setting is already enabled!"
        exit 0
fi

if ! [ -e $SYSCONFDIR/monit.avail/$SITENAME ]; then
        echo "This site does not exist!"
        exit 1
fi

if [ $SITENAME = "default" ]; then
        ln -sf $SYSCONFDIR/monit.avail/$SITENAME \
               $SYSCONFDIR/monit.enable/"$PRIORITY"-"$SITENAME"
else
        ln -sf $SYSCONFDIR/monit.avail/$SITENAME $SYSCONFDIR/monit.enable/$SITENAME
fi

echo "Setting $SITENAME installed; reload monit to enable."
